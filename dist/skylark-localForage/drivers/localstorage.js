/**
 * skylark-localForage - A skylark wrapper for localForage.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/isLocalStorageValid","../utils/serializer","../utils/promise","../utils/executeCallback","../utils/normalizeKey","../utils/getCallback"],function(e,r,t,n,a,o){"use strict";function i(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function l(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}return{_driver:"localStorageWrapper",_initStorage:function(e){var n={};if(e)for(var a in e)n[a]=e[a];return n.keyPrefix=i(e,this._defaultConfig),l()?(this._dbInfo=n,n.serializer=r,t.resolve()):t.reject()},_support:e(),iterate:function(e,r){var t=this,a=t.ready().then(function(){for(var r=t._dbInfo,n=r.keyPrefix,a=n.length,o=localStorage.length,i=1,l=0;l<o;l++){var u=localStorage.key(l);if(0===u.indexOf(n)){var f=localStorage.getItem(u);if(f&&(f=r.serializer.deserialize(f)),void 0!==(f=e(f,u.substring(a),i++)))return f}}});return n(a,r),a},getItem:function(e,r){var t=this;e=a(e);var o=t.ready().then(function(){var r=t._dbInfo,n=localStorage.getItem(r.keyPrefix+e);return n&&(n=r.serializer.deserialize(n)),n});return n(o,r),o},setItem:function(e,r,o){var i=this;e=a(e);var l=i.ready().then(function(){void 0===r&&(r=null);var n=r;return new t(function(t,a){var o=i._dbInfo;o.serializer.serialize(r,function(r,i){if(i)a(i);else try{localStorage.setItem(o.keyPrefix+e,r),t(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||a(e),a(e)}})})});return n(l,o),l},removeItem:function(e,r){var t=this;e=a(e);var o=t.ready().then(function(){var r=t._dbInfo;localStorage.removeItem(r.keyPrefix+e)});return n(o,r),o},clear:function(e){var r=this,t=r.ready().then(function(){for(var e=r._dbInfo.keyPrefix,t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}});return n(t,e),t},length:function(e){var r=this.keys().then(function(e){return e.length});return n(r,e),r},key:function(e,r){var t=this,a=t.ready().then(function(){var r,n=t._dbInfo;try{r=localStorage.key(e)}catch(e){r=null}return r&&(r=r.substring(n.keyPrefix.length)),r});return n(a,r),a},keys:function(e){var r=this,t=r.ready().then(function(){for(var e=r._dbInfo,t=localStorage.length,n=[],a=0;a<t;a++){var o=localStorage.key(a);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n});return n(t,e),t},dropInstance:function(e,r){if(r=o.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var a=this.config();e.name=e.name||a.name,e.storeName=e.storeName||a.storeName}var l,u=this;return l=e.name?new t(function(r){e.storeName?r(i(e,u._defaultConfig)):r(`${e.name}/`)}).then(function(e){for(var r=localStorage.length-1;r>=0;r--){var t=localStorage.key(r);0===t.indexOf(e)&&localStorage.removeItem(t)}}):t.reject("Invalid arguments"),n(l,r),l}}});
//# sourceMappingURL=../sourcemaps/drivers/localstorage.js.map
